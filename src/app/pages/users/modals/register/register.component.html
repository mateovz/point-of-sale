<div class="modal-header">
    <h5 class="modal-title" id="registerModalLabel" *ngIf="modalInfo.title">{{modalInfo.title}}</h5>
    <button type="button" class="btn-close" aria-label="Close"
        (click)="close()"
    ></button>
</div>
<div class="card text-center border-light pt-2" 
    [ngClass]="resMessage?.error ? 'text-danger' : 'text-success'" 
    *ngIf="resMessage?.message"
>
    {{resMessage.message}}
</div>
<div class="modal-body">
    <form [formGroup]="registerForm">
        <!-- avatar -->
        <div class="card p-2 mb-3">
            <img [src]="avatar" class="card-img-top w-50 m-auto" alt="avatar" *ngIf="avatar"/>
            <div class="input-group mt-2">
                <label class="input-group-text" for="avatar">Avatar</label>
                <input type="file" class="form-control" id="avatar"
                    formControlName="avatar" (change)="onFileChange($event)"
                    accept="image/*"
                >
            </div>
        </div>
        <!-- name -->
        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="floatingInputName" placeholder="Nombre"
                formControlName="name" required minlength="3"
            >
            <label for="floatingInputName">Nombre</label>
        </div>
        <!-- email -->
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="floatingInputEmail" placeholder="Correo electronico"
                formControlName="email" email required
            >
            <label for="floatingInputEmail">Correo electronico</label>
        </div>
        <!-- password -->
        <div class="input-group mb-3">
            <div class="form-floating flex-grow-1">
                <input class="form-control" id="password" placeholder="Contraseña"
                    [type]="hide ? 'password' : 'text'"
                    formControlName="password" minlength="6" required
                >
                <label for="password">Contraseña</label>
            </div>
            <!-- generate password -->
            <button class="btn btn-outline-primary" type="button" 
                (click)="newPass()" title="Generar nueva contraseña" [disabled]="!changePass && modalInfo.action === 'update'"
            >
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            <!-- show/hide password -->
            <button class="btn btn-outline-primary" type="button"
                [disabled]="!changePass && modalInfo.action === 'update'"
                (click)="hide=!hide" [title]="(hide ? 'Mostrar' : 'Ocultar') + ' contraseña'"
            >
                <i class="bi" [ngClass]="hide ? 'bi-eye-fill' : 'bi-eye-slash-fill'"></i>
            </button>
        </div>
        <!-- change password -->
        <div class="form-check form-switch d-inline-block" (change)="checkedChangePass()"
            *ngIf="modalInfo.action === 'update'"
        >
            <input class="form-check-input" type="checkbox" role="switch" id="changePass">
            <label class="form-check-label" for="changePass">Cambiar contraseña</label>
        </div>
        <!-- roles -->
        <div class="roles card p-2 mt-3" *ngIf="checkPermission('user.change.roles')">
            <div class="card-header mb-2">Roles</div>
            <div class="form-check role" *ngFor="let role of roles">
                <input class="form-check-input" type="checkbox" 
                    [value]="role.id" [id]="role.slug" (change)="onChangeCheckRoles(role.id)"
                    [checked]="findRoleForm(role.id)"
                >
                <label class="form-check-label" [for]="role.slug">
                    {{role.name}}
                </label>
            </div>
        </div>           
    </form>
</div>
<div class="modal-footer">
    <button #closeModal type="button" class="btn btn-secondary" (click)="close()">Cancelar</button>
    <button type="button" class="btn btn-primary" 
        form="registerForm"
        (click)="onSave()" 
        [disabled]="!registerForm.valid"
    >Guardar</button>
</div>